<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Azure Monitor Cost Optimizer</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-top">
                <div class="logo">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="48" height="48">
                        <path fill="#0078d4" d="M24 4C12.954 4 4 12.954 4 24s8.954 20 20 20 20-8.954 20-20S35.046 4 24 4z"/>
                        <path fill="#fff" d="M24 8c-8.837 0-16 7.163-16 16s7.163 16 16 16 16-7.163 16-16S32.837 8 24 8zm0 28c-6.627 0-12-5.373-12-12s5.373-12 12-12 12 5.373 12 12-5.373 12-12 12z"/>
                        <path fill="#50e6ff" d="M24 14v10l7 7"/>
                    </svg>
                    <h1>Azure Monitor Cost Optimizer</h1>
                </div>
                <div class="auth-section">
                    <div class="theme-toggle">
                        <span class="theme-icon">‚òÄÔ∏è</span>
                        <div class="theme-toggle-btn" id="themeToggle">
                            <div class="theme-toggle-slider"></div>
                        </div>
                        <span class="theme-icon">üåô</span>
                    </div>
                    <div class="auth-status" id="authStatus">
                        <span class="status-indicator checking" id="statusIndicator">‚óè</span>
                        <span id="statusText">Checking Azure CLI...</span>
                    </div>
                </div>
            </div>
            <p class="subtitle">Get AI-powered recommendations based on your actual Azure Monitor usage</p>
        </header>

        <main>
            <!-- Auth Required Message -->
            <section class="auth-required-section" id="authRequiredSection">
                <div class="auth-required-content">
                    <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#f44336" stroke-width="1.5">
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="12" y1="8" x2="12" y2="12"/>
                        <line x1="12" y1="16" x2="12.01" y2="16"/>
                    </svg>
                    <h2>Azure CLI Authentication Required</h2>
                    <p>Run the following command in your terminal to sign in:</p>
                    <code class="cli-command">az login</code>
                    <p class="auth-note">After signing in, refresh this page.</p>
                    <button id="retryBtn" class="primary-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="23 4 23 10 17 10"></polyline>
                            <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
                        </svg>
                        Retry Connection
                    </button>
                </div>
            </section>

            <!-- Main Input Section -->
            <section class="input-section" id="inputSection" hidden>
                <h2>Select Your Workspace</h2>
                
                <!-- Recent Analyses -->
                <div id="recentAnalyses" class="recent-analyses" hidden>
                    <h3>üìã Recent Analyses</h3>
                    <div id="recentAnalysesList" class="recent-analyses-list"></div>
                </div>
                
                <form id="azureForm">
                    <div class="form-group">
                        <label for="subscriptionFilter">Subscription</label>
                        <input type="text" id="subscriptionFilter" class="filter-input" placeholder="Type to filter subscriptions..." autocomplete="off">
                        <select id="subscriptionSelect" name="subscriptionSelect">
                            <option value="">Loading subscriptions...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Log Analytics Workspaces</label>
                        <div class="workspace-controls">
                            <input type="text" id="workspaceFilter" class="filter-input-small" placeholder="Filter workspaces...">
                            <button type="button" id="selectAllBtn" class="select-btn">All</button>
                            <button type="button" id="selectNoneBtn" class="select-btn">None</button>
                            <button type="button" id="expandAllBtn" class="select-btn">Expand</button>
                            <button type="button" id="collapseAllBtn" class="select-btn">Collapse</button>
                            <span id="selectedCount" class="selected-count">0 selected</span>
                        </div>
                        <div id="workspaceList" class="workspace-list">
                            <div class="workspace-placeholder">Select a subscription first</div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="context">Additional Context <span class="optional">(optional)</span></label>
                        <textarea id="context" name="context" rows="3" 
                                  placeholder="Any specific concerns or areas you'd like us to focus on..."></textarea>
                    </div>

                    <button type="submit" id="submitBtn">
                        <span class="btn-text">Analyze & Get Recommendations</span>
                        <span class="btn-loader" style="display: none;">
                            <svg class="spinner" viewBox="0 0 24 24">
                                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="3" fill="none" stroke-dasharray="31.416" stroke-dashoffset="10"/>
                            </svg>
                            <span id="loadingStatus">Querying workspace...</span>
                        </span>
                    </button>
                </form>
            </section>

            <!-- Analysis Progress Section -->
            <section class="progress-section" id="progressSection" hidden>
                <h2>Analyzing Your Environment</h2>
                <div class="progress-content">
                    <div class="progress-item" id="progressQueries">
                        <span class="progress-icon">‚è≥</span>
                        <span class="progress-text">Running analysis queries...</span>
                    </div>
                    <div class="progress-item" id="progressAI">
                        <span class="progress-icon">‚è≥</span>
                        <span class="progress-text">Generating AI recommendations...</span>
                    </div>
                </div>
            </section>

            <section class="recommendations-section" id="recommendationsSection" hidden>
                <h2>Cost Optimization Recommendations</h2>
                
                <!-- Cost Savings Counter -->
                <div id="savingsCounter" class="savings-counter" hidden>
                    <div class="savings-counter-main">
                        <div class="savings-label">üí∞ Total Potential Savings</div>
                        <div class="savings-amount" id="savingsAmount">$0.00</div>
                        <div class="savings-period">per month</div>
                    </div>
                    <div class="savings-breakdown" id="savingsBreakdown"></div>
                </div>
                
                <div class="recommendations-header">
                    <div class="workspace-info" id="resourceInfo"></div>
                    <div class="header-buttons">
                        <button id="copyBtn" class="copy-btn" title="Copy recommendations as plain text">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                            </svg>
                            Copy
                        </button>
                        <button id="copyMarkdownBtn" class="copy-btn" title="Copy as Markdown">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="7 10 12 15 17 10"></polyline>
                                <line x1="12" y1="15" x2="12" y2="3"></line>
                            </svg>
                            Markdown
                        </button>
                    </div>
                </div>
                <div id="recommendationsContent" class="recommendations-content"></div>
                
                <!-- Checklist Tracker -->
                <div id="checklistTracker" class="checklist-tracker" hidden>
                    <h3>üìã Implementation Checklist</h3>
                    <p class="checklist-subtitle">Track your progress implementing these recommendations</p>
                    <div id="checklistProgress" class="checklist-progress">
                        <div class="progress-bar-container">
                            <div id="checklistProgressBar" class="progress-bar" style="width: 0%"></div>
                        </div>
                        <span id="checklistProgressText" class="progress-text">0 of 0 completed (0%)</span>
                    </div>
                    <div id="checklistItems" class="checklist-items"></div>
                    <button id="resetChecklistBtn" class="secondary-btn" style="margin-top: 10px;">Reset Checklist</button>
                </div>
                
                <button id="newAnalysisBtn" class="secondary-btn">Start New Analysis</button>
            </section>

            <section class="quick-tips">
                <h2>Quick Reference: Azure Monitor Cost Best Practices</h2>
                <div class="tips-grid">
                    <div class="tip-card">
                        <div class="tip-icon">üìä</div>
                        <h3>Log Analytics</h3>
                        <ul>
                            <li>Use commitment tiers for predictable workloads</li>
                            <li>Configure Basic Logs for debug tables</li>
                            <li>Set up data retention policies</li>
                            <li>Create alerts for high data collection</li>
                        </ul>
                    </div>
                    <div class="tip-card">
                        <div class="tip-icon">üñ•Ô∏è</div>
                        <h3>Virtual Machines</h3>
                        <ul>
                            <li>Migrate to Azure Monitor Agent</li>
                            <li>Filter unnecessary data at collection</li>
                            <li>Reduce performance counter frequency</li>
                            <li>Avoid duplicate data collection</li>
                        </ul>
                    </div>
                    <div class="tip-card">
                        <div class="tip-icon">üì¶</div>
                        <h3>Containers</h3>
                        <ul>
                            <li>Use Managed Prometheus for metrics</li>
                            <li>Configure Container Insights selectively</li>
                            <li>Use Basic Logs for container logs</li>
                            <li>Implement OpenCost for visibility</li>
                        </ul>
                    </div>
                    <div class="tip-card">
                        <div class="tip-icon">üîî</div>
                        <h3>Alerts</h3>
                        <ul>
                            <li>Use free alert types when possible</li>
                            <li>Minimize log search alert frequency</li>
                            <li>Reduce metric alert resource scope</li>
                            <li>Set up Azure Advisor alerts</li>
                        </ul>
                    </div>
                </div>
            </section>
        </main>

        <footer>
            <p>Based on <a href="https://learn.microsoft.com/en-us/azure/azure-monitor/fundamentals/best-practices-cost" target="_blank">Azure Monitor Cost Optimization Best Practices</a></p>
            <p class="disclaimer">This tool provides recommendations based on best practices and your actual usage. Always review changes in a non-production environment first.</p>
        </footer>
    </div>

    <script src="azure-queries.js"></script>
    <script src="app.js"></script>
</body>
</html>
